<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Chromecast Receiver</title>
  <script src="https://www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  <style>
    html, body { margin: 0; width: 100%; height: 100%; background: gray; }
    video { width: 100%; height: 100%; }
    #debug {
      position: absolute;
      top: 10px;
      left: 10px;
      max-width: 90%;
      background: rgba(0,0,0,0.7);
      padding: 10px;
      font-size: 14px;
      white-space: pre-wrap;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <video id="video" controls></video>
  <div id="debug">Waiting for LOAD…</div>
  <!-- <cast-media-player></cast-media-player> -->

  <script>
    const debugEl = document.getElementById('debug');

    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();

    // function renderDebug(media, activeTrackIds) {
    //   if (!media || !media.tracks) {
    //     debugEl.textContent = 'No tracks';
    //     return;
    //   }

    //   const lines = [];
    //   lines.push('Tracks received:\n');

    //   media.tracks.forEach(track => {
    //     const active = activeTrackIds?.includes(track.trackId);
    //     lines.push(
    //       `${active ? '▶' : ' '} ID ${track.trackId}` +
    //       ` | ${track.type}` +
    //       ` | ${track.subtype || ''}` +
    //       ` | ${track.language || ''}` +
    //       ` | ${track.name || ''}`
    //     );
    //   });

    //   debugEl.textContent = lines.join('\n');
    // }

    // Activate first track
    playerManager.setMessageInterceptor(
      cast.framework.messages.MessageType.LOAD,
      request => {
      const tracks = request.media?.tracks;
      if (tracks) {
        const captionTrack = tracks.find(t => t.type === 'TEXT');
        if (captionTrack) {
          request.activeTrackIds = [captionTrack.trackId];
        }
      }
      debugEl.textContent = `Activating track ID ${tracks}`;
      // renderDebug(request.media, activeTrackIds);
      return request;
    }
    );
    context.start();
  </script>
</body>
</html>